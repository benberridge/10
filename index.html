<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- CSP via meta tag, now allowing inline CSS & JS -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
          style-src  'self' https://fonts.googleapis.com 'unsafe-inline';
          connect-src 'self' https://rpc.sonic.network;
          font-src   'self' https://fonts.gstatic.com;
          img-src    'self' data: https://*.ardrive.net;
        " />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sonic10 Mint Page</title>

  <!-- Google Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
    rel="stylesheet"
  />

  <style>
    /* Reset & base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Roboto', sans-serif;
      overflow-y: auto;
      background: linear-gradient(45deg, #0066cc, #00ccff, #001f4d, #0099ee);
      background-size: 400% 400%;
      animation: sonic-bg 20s ease infinite alternate;
    }
    @keyframes sonic-bg { from { background-position: 0% 0%; } to { background-position: 100% 100%; } }

    /* Wallet button */
    #wallet-button {
      position: absolute; top:1rem; right:1rem;
      padding:.5rem 1rem; border:none; border-radius:6px;
      background:#1e90ff; color:#fff; font-size:.9rem;
      cursor:pointer; transition:background .2s; z-index:10;
    }
    #wallet-button:hover { background:#007acc }

    /* Banner with silver edge */
    .banner-wrapper {
      margin:2rem auto 1rem;
      max-width:225px; width:60%; border-radius:12px;
      background-image:
        linear-gradient(rgba(255,255,255,.1),rgba(255,255,255,.1)),
        linear-gradient(45deg,#bbb,#ddd,#ccc,#eee);
      background-clip:padding-box,border-box;
      border:2mm solid transparent;
      background-size:100% 100%,400% 400%;
      animation:silver-edge 20s ease infinite alternate;
      box-shadow:
        0 4px 12px rgba(0,0,0,.25),
        inset 2px 2px 4px rgba(255,255,255,.6),
        inset -2px -2px 4px rgba(0,0,0,.2);
    }
    .banner-wrapper img { display:block; width:100%; border-radius:10px; }
    @keyframes silver-edge { from { background-position:0% 0%,0% 0%; } to { background-position:100% 100%,100% 100%; } }

    /* Boxes */
    .lower-section {
      position:absolute; top:50%; left:5%; width:90%;
      transform:translateY(-50%);
      display:flex; gap:1rem; justify-content:space-between;
    }
    .box {
      flex:0 0 352px; padding:1rem; border-radius:12px;
      background-image:
        linear-gradient(rgba(255,255,255,.9),rgba(255,255,255,.9)),
        linear-gradient(45deg,#FFB74D,#81D4FA,#FFE0B2,#B3E5FC);
      background-clip:padding-box,border-box;
      border:2mm solid transparent;
      background-size:100% 100%,400% 400%;
      animation:orange-blue-edge 20s ease infinite alternate;
      box-shadow:
        0 4px 12px rgba(0,0,0,.1),
        inset 2px 2px 4px rgba(255,255,255,.6),
        inset -2px -2px 4px rgba(0,0,0,.2);
    }
    .box.coming-soon {
      display:flex; align-items:center; justify-content:center;
      font-size:1.25rem; color:#555;
    }
    @keyframes orange-blue-edge { from { background-position:0% 0%,0% 0%; } to { background-position:100% 100%,100% 100%; } }

    /* Mint controls */
    .mint-controls { width:100%; }
    .mint-controls h1 {
      font-size:1.5rem; font-weight:500;
      text-align:center; margin-bottom:1.5rem; color:#333;
    }
    .mint-controls label {
      font-weight:500; color:#555;
      display:block; margin-bottom:.5rem;
    }
    .mint-controls select {
      width:100%; padding:.5rem; margin-bottom:1.5rem;
      border:1px solid #ccc; border-radius:6px; background:#fafafa;
    }
    .mint-controls button {
      width:100%; padding:.75rem; border:none; border-radius:6px;
      background:#1e90ff; color:#fff; font-weight:500;
      cursor:pointer; transition:background .3s;
    }
    .mint-controls button:hover { background:#007acc }
    #status {
      margin-top:1rem; font-size:.9rem; color:#333;
      text-align:center; min-height:1.2em;
    }

    /* Social footer */
    .socials {
      position:absolute; bottom:1rem; left:50%;
      transform:translateX(-50%); display:flex; gap:1rem;
    }
    .socials a { width:24px; height:24px; display:block; }
    .socials img { width:100%; height:100%; object-fit:contain; }

    /* Mobile tweaks */
    @media (max-width:768px) {
      .lower-section {
        position:static; transform:none; margin:1rem 0; padding:0 10%;
        display:flex; overflow-x:auto; scroll-snap-type:x mandatory;
      }
      .box { flex:0 0 80%; max-width:80%; scroll-snap-align:start; }
    }
  </style>
</head>
<body>
  <button id="wallet-button">Connect Wallet</button>

  <div class="banner-wrapper">
    <img
      src="https://d5z5gg6ru5enr7l6wb6sdgcjdmju3qtap3eo4du77bry4udg2jiq.ardrive.net/H3PTG9GnSNj9frB9IZhJGxNNwmB-yO4On_hjjlBm0lE"
      alt="Sonic10 Banner"
    />
  </div>

  <div class="lower-section">
    <div class="box">
      <div class="mint-controls">
        <h1>Sonic10 NFT Mint</h1>
        <label for="power-select">Select Power</label>
        <select id="power-select">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <button id="mint-button">Mint</button>
        <div id="status"></div>
      </div>
    </div>
    <div class="box coming-soon">Coming soon</div>
    <div class="box coming-soon">Coming soon</div>
  </div>

  <div class="socials">
    <a href="#" id="docs-link"><img src="PATH_TO_BOOK_ICON" alt="Docs"></a>
    <a href="#" id="x-link"><img src="PATH_TO_X_ICON" alt="X"></a>
    <a href="#" id="telegram-link"><img src="PATH_TO_TELEGRAM_ICON" alt="Telegram"></a>
  </div>

  <script type="module">
    import * as ethers from 'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js';

    const SONIC10_ABI = [
      'function feeForPower(uint8 power) public view returns (uint256)',
      'function mint(uint8 power) external payable'
    ];
    const CONTRACT_ADDRESS = '0x7D9aD34Ea9436659327ba1d765bC9743a7C3E778';

    const walletBtn   = document.getElementById('wallet-button');
    const statusEl    = document.getElementById('status');
    const powerSelect = document.getElementById('power-select');
    const mintBtn     = document.getElementById('mint-button');

    let provider, signer, account;

    walletBtn.addEventListener('click', async () => {
      if (!window.ethereum) {
        alert('Please install a wallet extension.');
        return;
      }
      if (!account) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        const [acct] = await window.ethereum.request({ method: 'eth_requestAccounts' });
        account = acct;
        signer  = provider.getSigner();
        walletBtn.textContent = 'Disconnect';
      } else {
        account = signer = provider = null;
        walletBtn.textContent = 'Connect Wallet';
        statusEl.textContent = '';
      }
    });

    mintBtn.addEventListener('click', async () => {
      statusEl.textContent = '';
      if (!signer) {
        statusEl.textContent = 'Please connect your wallet first.';
        return;
      }
      const power    = parseInt(powerSelect.value, 10);
      const contract = new ethers.Contract(CONTRACT_ADDRESS, SONIC10_ABI, signer);

      try {
        statusEl.textContent = 'Fetching fee…';
        const fee = await contract.feeForPower(power);
        statusEl.textContent = 'Sending transaction…';
        const tx = await contract.mint(power, { value: fee });
        statusEl.textContent = `Transaction sent: ${tx.hash}`;
        await tx.wait();
        statusEl.textContent = `Mint confirmed! Power ${power}.`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Mint failed: ' + (err.error?.message || err.message);
      }
    });

    if (window.ethereum) {
      window.ethereum.on('accountsChanged', (accounts) => {
        account = accounts[0] || null;
        walletBtn.textContent = account ? 'Disconnect' : 'Connect Wallet';
        if (!account) statusEl.textContent = '';
      });
    }
  </script>
</body>
</html>
